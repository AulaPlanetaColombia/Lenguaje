/* VERSION : 15.12.21.1 */ 
this.createjs=this.createjs||{};(function(){var b=function(h,g,f){this.initialize(h,g,f)};var e=b.prototype=new createjs.DisplayObject();var c=function(g,f){this.text=g;this.style=f};var d=function(){this.items=new Array();this.align="left";this.topMargin=0;this.bottomMargin=0;this.lineSepExtra=0;this.paraWidth=0};createjs.HTMLTextRun=c;createjs.HTMLTextPara=d;var a=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"));if(a.getContext){b._workingContext=a.getContext("2d");a.width=a.height=1}e.text="";e.font=null;e.color=null;e.textAlign="left";e.textBaseline="top";e.maxWidth=null;e.outline=0;e.lineHeight=0;e.lineWidth=null;e.borderColor=null;e.backgroundColor=null;e.leftMargin=0;e.rightMargin=0;e.topMargin=0;e.bottomMargin=0;e.yPatch=-1;e.calcMaxWidth=0;e.DisplayObject_initialize=e.initialize;e.initialize=function(h,g,f){this.DisplayObject_initialize();this.text=h;this.font=g;this.color=f;this.calcMaxWidth=this._calcText(null,{}).width};e.isVisible=function(){var f=this.cacheCanvas||(this.text!=null);return !!(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&f)};e.DisplayObject_draw=e.draw;e.draw=function(f,i){if(this.DisplayObject_draw(f,i)){return true}var g;if(this.borderColor!=null||this.backgroundColor!=null){var h=this.getBounds();if(this.backgroundColor!=null){g=this.backgroundColor;f.fillStyle=g;f.rect(h.x+0.5,h.y+0.5,h.width,h.height);f.fill()}if(this.borderColor!=null){g=this.borderColor;f.strokeStyle=g;f.rect(h.x+0.5,h.y+0.5,h.width,h.height);f.stroke()}}g=this.color||"#000";if(this.outline){f.strokeStyle=g;f.lineWidth=this.outline*1}else{f.fillStyle=g}this._drawText(this._prepContext(f));return true};e.getMeasuredWidth=function(){return this._drawText(null,{}).width};e.getMeasuredHeight=function(){return this._drawText(null,{}).height};e.getMeasuredLineHeight=function(f){return f.measureText("M").width*1.3};e.DisplayObject_getBounds=e.getBounds;e.getBounds=function(){var f=this.DisplayObject_getBounds();if(f){return f}if(this.text==null){return null}var g=this._drawText(null,{});return this._rectangle.initialize(0,0,g.width,g.height)};e.clone=function(){var f=new b(this.text,this.font,this.color);this.cloneProps(f);return f};e.toString=function(){return"[HTMLText (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"};e.DisplayObject_cloneProps=e.cloneProps;e.cloneProps=function(f){this.DisplayObject_cloneProps(f);f.maxWidth=this.maxWidth;f.outline=this.outline;f.lineHeight=this.lineHeight;f.lineWidth=this.lineWidth;f.borderColor=this.borderColor;f.backgroundColor=this.backgroundColor;f.leftMargin=this.leftMargin;f.rightMargin=this.rightMargin;f.topMargin=this.topMargin;f.bottomMargin=this.bottomMargin;f.yPatch=this.yPatch};e._prepContext=function(f){f.font=this.font;f.textAlign="left";f.textBaseline="top";return f};e._calcText=function(){var u=this._prepContext(b._workingContext);if(this.yPatch==-1){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){this.yPatch=0}else{this.yPatch=u.measureText("M").width*0.25}}var n=0;if(this.lineWidth>0){n=this.lineWidth-this.leftMargin-this.rightMargin}var t=0;var g="";var r=this.leftMargin;var q=this.topMargin;for(var m=0;m<this.text.length;m++){var f=this.text[m];var l=0;var s=this.lineHeight||Math.ceil(this.getMeasuredLineHeight(u));r=this.leftMargin;q+=f.topMargin;for(var k=0;k<f.items.length;k++){var v=f.items[k];if(n>0){}else{var p=v.style+" "+this.font;if(g!=p){u.font=p;g=p}r+=Math.ceil(u.measureText(v.text).width);l=r}}q+=s;q+=f.bottomMargin;l+=this.rightMargin;f.paraWidth=l;if(t<l){t=l}}q+=this.bottomMargin;var h={};h.count=this.text.length;h.width=t;h.height=q;return h};e._drawText=function(w,h){var p=!!w;var k=true;if(!p){w=this._prepContext(b._workingContext);k=false}if(this.yPatch==-1){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){this.yPatch=0}else{this.yPatch=w.measureText("M").width*0.25}}var q=0;if(this.lineWidth>0){q=this.lineWidth-this.leftMargin-this.rightMargin}var v=0;var g="";var t=this.leftMargin;var s=this.topMargin;for(var n=0;n<this.text.length;n++){var f=this.text[n];var m=0;var u=this.lineHeight||Math.ceil(this.getMeasuredLineHeight(w));t=this.leftMargin;s+=f.topMargin;if(f.align=="center"){t=this.leftMargin+(this.calcMaxWidth-f.paraWidth)/2}else{if(f.align=="right"){t=this.leftMargin+this.calcMaxWidth-f.paraWidth}}for(var l=0;l<f.items.length;l++){var z=f.items[l];if(q>0){}else{var r=z.style+" "+this.font;if(g!=r){w.font=r;g=r}if(k){if(this.outline){w.strokeText(z.text,0,s-this.yPatch,65535)}else{w.fillText(z.text,t,s-this.yPatch,65535)}}t+=Math.ceil(w.measureText(z.text).width);m=t}}s+=u;s+=f.bottomMargin;m+=this.rightMargin;if(v<m){v=m}}s+=this.bottomMargin;if(h){h.count=this.text.length;h.width=v;h.height=s}return h};b.formatPlainText=function(o){var l=new Array();var p=String(o).split(/(?:\r\n|\r|\n|<br[^>]*>)/);var f;var g;for(var k=0;k<p.length;k++){var m=p[k];f=new createjs.HTMLTextPara();var n=m.split(/(\s)/);for(var h=0;h<n.length;h++){g=new createjs.HTMLTextRun(n[h],"");f.items.push(g)}l.push(f)}return l};createjs.HTMLText=b}());var TouchComp={eventPointerDown:"",eventPointerUp:"",eventPointerMove:"",isTouchOperation:false,isTouchDevice:function(){try{document.createEvent("TouchEvent");return"ontouchstart" in window||"onmsgesturechange" in window}catch(a){return false}},init:function(){if(this.isTouchDevice()){this.eventPointerDown="touchstart";this.eventPointerUp="touchend";this.eventPointerMove="touchmove"}else{this.eventPointerDown="mousedown";this.eventPointerUp="mouseup";this.eventPointerMove="mousemove"}},fixTouch:function(e){var c=window.pageXOffset,b=window.pageYOffset,a=e.clientX,d=e.clientY;if(e.pageY===0&&Math.floor(d)>Math.floor(e.pageY)||e.pageX===0&&Math.floor(a)>Math.floor(e.pageX)){a=a-c;d=d-b}else{if(d<(e.pageY-b)||a<(e.pageX-c)){a=e.pageX-c;d=e.pageY-b}}return{x:a,y:d}},getEventScreenCoords:function(b){if(this.isTouchDevice()){var c=b.changedTouches[0];var a=new Object();a.x=c.pageX;a.y=c.pageY;return a}else{var a=new Object();a.x=b.screenX;a.y=b.screenY;return a}}};var XDOM={newXML:function(a){if(jQuery.browser.msie){var c=new ActiveXObject("Microsoft.XMLDOM");if(a!=""&&a!=null&&a!=undefined){var b="<"+a+"></"+a+">";c.loadXML(b)}return c}else{if(document.implementation.createDocument){return document.implementation.createDocument("",a,null)}}return null},newXMLFromString:function(b){var c;var a;if(jQuery.browser.msie){a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(b)}else{c=new DOMParser();a=c.parseFromString(b,"text/xml")}return a},newXMLFromURL:function(a,c,b){$.ajax({type:"GET",url:a,async:false,dataType:($.browser.msie)?"text":"xml",success:function(e){var d;if(typeof e==="string"){d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(e)}else{d=e}if(c!=null||c!=undefined||c!=""){c(d)}},error:function(d,f,e){if(b!=null||b!=undefined||b!=""){b(f,e)}}})},cloneXML:function(e){var d;if(typeof(ActiveXObject)!="undefined"){d=new ActiveXObject("Microsoft.XMLDOM");var a=e.documentElement;var c=a.cloneNode(true);d.appendChild(c)}else{d=e.implementation.createDocument(e.namespaceURI,null,null);var b=d.importNode(e.documentElement,true);d.appendChild(b)}return(d)},mergeXML:function(g,f,d,e){var b=XDOM.cloneXML(g);var a=$(b);var c=$(f);c.children(d).children().each(function(){var k=this.nodeName;var i=a.children(d).children(k)[0];var h;if(i){h=i.nodeName}else{h=""}if(e==null||e==undefined){e=2}var j=false;switch(e){case 1:if(k==h){j=true}break;case 3:if(k!=h){j=true}break;case 4:break;case 2:default:j=true}if(j){XDOM.removeNode(i);XDOM.appendNode(a.children(d)[0],this)}});return b},XMLToString:function(c){var b;if(window.ActiveXObject){b=c.xml}else{var a=new XMLSerializer();b=a.serializeToString(c)}return b},nodeByPath:function(g,l){var d=l.split(".");var f=$(g).children("motor");var e;var c=f[0];for(e=0;e<d.length;e++){var b=d[e];if(e==(d.length-1)){var j;if(b.indexOf("@")!==-1){if(c==null){return null}return c}else{if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var k=b.substring(0,b.indexOf("["));j=$(c).children(k);if(j==null||j.length==0||h>(j.length-1)){return null}return j[h]}else{j=$(c).children(b);if(j==null||j.length==0){return null}return j[0]}}}else{var a;if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var k=b.substring(0,b.indexOf("["));a=$(c).children(k);if(a==null||a.length==0||h>(a.length-1)){return null}c=a[h]}else{a=$(c).children(b);if(a==null||a.length==0){return null}c=a[0]}}}return null},valueOfNode:function(g,m){var d=m.split(".");var f=$(g).children();var e;var c=f[0];for(e=0;e<d.length;e++){var b=d[e];if(e==(d.length-1)){var k;if(b.indexOf("@")!==-1){if(c==null){return""}var j=b.substring(1);return $(c).attr(j)}else{if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var l=b.substring(0,b.indexOf("["));k=$(c).children(l);if(k==null||k.length==0||h>(k.length-1)){return""}return $(k[h]).text()}else{k=$(c).children(b);if(k==null||k.length==0){return""}return $(k[0]).text()}}}else{var a;if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var l=b.substring(0,b.indexOf("["));a=$(c).children(l);if(a==null||a.length==0||h>(a.length-1)){return""}c=a[h]}else{a=$(c).children(b);if(a==null||a.length==0){return""}c=a[0]}}}return""},valueOfXMLNode:function(a){return $(a).text()},newNode:function(c){var b=XDOM.newXML(c);var a=$(b).children(c)[0];return a},removeNode:function(a){if(a==null||a==undefined){return}if(jQuery.browser.msie==true){a.parentNode.removeChild(a)}else{$(a).remove()}},appendNode:function(c,a){var b=a.cloneNode(true);c.appendChild(b)},getTextNodes:function(a){return $(a).contents().filter(function(){return(((this.nodeName=="#text"&&this.nodeType=="3")||this.nodeType=="4")&&($.trim(this.nodeValue.replace("\n",""))!==""))})},setNodeValue:function(b,c){var a=XDOM.getTextNodes(b);if(a.get(0)){a.get(0).nodeValue=c}else{b.textContent=c}},setNewNodeCDATAValue:function(b,c,d){var a=b.createCDATASection(d);c.appendChild(a);return a}};var XAUDIO={_tagIdPrefix:"ssi_ae",_nextIndex:0,audioGetId:function(a){return XAUDIO._tagIdPrefix+"_audio_"+a},audioCreateTag:function(b){var a=this._nextIndex;this._nextIndex++;var d=XAUDIO.audioGetId(a);var c="<audio id='"+d+"' preload='auto'>		<source src='"+encodeURI(b)+"' type='audio/mpeg'/></audio>";$(document.body).append(c);document.getElementById(d).addEventListener("playing",function(){$(this).attr("hasBeenPlayed","1")},false);return a},audioStart:function(a,c){var d=XAUDIO.audioGetId(a);var b=document.getElementById(d);if(!b){return}if($(b).attr("hasBeenPlayed")=="1"){b.currentTime=0}b.play();b.muted=c||false},audioStop:function(a){var c=XAUDIO.audioGetId(a);var b=document.getElementById(c);if(!b){return}if(!b.paused){b.pause()}},audioPlay:function(a,c){var d=XAUDIO.audioGetId(a);var b=document.getElementById(d);if(!b){return}if(b.paused){b.play();b.muted=c||false}},audioPause:function(a){var c=XAUDIO.audioGetId(a);var b=document.getElementById(c);if(!b){return}if(!b.paused){b.pause()}},audioUpdateMute:function(a,c){var d=XAUDIO.audioGetId(a);var b=document.getElementById(d);if(!b){return}b.muted=c||false}};function ExtendedShape(){this.embedShape=function(c,g){var d=new createjs.Container();var i;var a=c.width,f=c.height;i=new createjs.Shape();i.graphics.beginFill("#99BBFF");i.graphics.drawRect(0,0,a+2*g,f+2*g);i.graphics.endFill();i.alpha=0.01;var e=new createjs.Container();var b=new createjs.Shape();b.graphics.beginFill("#EEAAFF");b.graphics.drawRect(0,0,a,f);b.graphics.endFill();b.alpha=0.01;d.addChild(i);d.addChild(e);e.addChild(b);e.addChild(c);e.x=e.y=g;d.regX=d.regY=g;d.visible=true;d.width=c.width;d.height=c.height;return d};this.createTriangle=function(b,j,a,d,e){if(a==undefined){a=true}if(d==undefined){d=false}if(e==undefined){e="#000000"}var c;if(a==true){c=0}else{c=-90}var i=new createjs.Container();var f=new createjs.Shape();f.graphics.beginFill("#FFAAFF");f.graphics.drawRect(0,0,b,j);f.graphics.endFill();f.alpha=0.01;var g=new createjs.Shape();var h=b/2;if(d){c+=180;g.graphics.beginFill(e).drawPolyStar(b/2,j/2,h,3,0,c)}else{g.graphics.beginFill(e).drawPolyStar(b/2,j/2,h,3,0,c)}g.graphics.endFill();g.visible=true;i.width=b;i.height=j;i.addChild(f);i.addChild(g);return i};this.addRoundedBorder=function(e,d,c,b,h){if(b==undefined){b="#000000"}if(h==undefined){h="#FFFFFF"}var f=new createjs.Container();var g=new createjs.Shape();g.graphics.beginFill(h);g.graphics.drawCircle(0,0,e.width/2+c);g.graphics.endFill();var a=new createjs.Shape();a.graphics.beginFill(b).arc(0,0,e.width/2+d+c,0,Math.PI*2,true).arc(0,0,e.width/2+c,Math.PI*2,0,false);a.x=a.y=e.width/2;g.x=g.y=e.width/2;f.addChild(a);f.addChild(g);f.addChild(e);f.width=e.width;f.height=e.height;return f};this.createRoundedCornersRect_=function(l,j,f,b,m,d,i){var g=4;if(d==undefined){d="#000000"}if(i==undefined){i="#FFFFFF"}var k=new createjs.Container();var e=new createjs.Shape();e.graphics.beginFill(i);e.graphics.drawRoundRect(0,0,j,f,g);e.graphics.endFill();var c=new createjs.Shape();c.graphics.beginFill(d);c.graphics.drawRoundRect(0,0,j+b*2,f+50+b*2,g);k.addChild(c);k.addChild(e);k.addChild(l);e.x=e.y=b;var a=l.getBounds();l.x=j/2-a.width/2;k.width=j+b;k.height=f+b;return k};this.createRoundedCornersRect=function(k,i,e,b,l,c,g){var f=4;if(c==undefined){c="#000000"}if(g==undefined){g="#FFFFFF"}var j=new createjs.Container();var d=new createjs.Shape();d.graphics.beginFill(g);d.graphics.drawRoundRect(0+0.5,0+0.5,i+b*2,e+b*2,f);d.graphics.endFill();d.graphics.beginStroke(c);d.graphics.drawRoundRect(0+0.5,0+0.5,i+b*2,e+b*2,f);d.graphics.endStroke();j.addChild(d);j.addChild(k);d.x=d.y=b;var a=k.getBounds();k.x=i/2-a.width/2+2;k.y=k.y+1;j.width=i+b;j.height=e+b;return j}}function pppMapaConceptual(b,a){if(b==undefined){alert("Hay que passar el ID de un elemento HTML al Mapa Conceptual.");return}this.MC_WIDTH=950;this.MC_HEIGHT=608;this.luzInterGlobal=40;this.anchoMedioHoja=464;this.fontGlobal="Verdana";this.IMAGE_SCALE=0.25;this.lInterlineados=[1+3,2+3,3+3,4+3,5+3,6+3,7+3,8+3,9+3,10+3,11+3,12+3,13+3,14+3,15+3,16+3,17+3,18+3,19+3,20+3,21+3,22+3,23+3,24+3,25+3,26+3,27+3,28+3,29+3,30+3];this.TOP_BORDER=6;this.BUTTON_W=30;this.BUTTON_H=30;this.BUTTON_SEP=2;this.B_SIDE_BORDER=4;this.B_RIGHT_BORDER=30;this.TEXT_BUTTON_W=100;this.FLECHA_DN_W=15;this.FLECHA_DN_H=15;this.FLECHA_UP_W=15;this.FLECHA_UP_H=15;this.FLECHA_AUDIO_W=13;this.FLECHA_AUDIO_H=13;this._debug=a||false;this._mcContainerName=b;this._mcContainer;this._mcCanvas;this.cWidth;this.cHeight;this._isIOS;this._isNativeBrowser;this._isAndroid;this._isChrome;this.cacheEnabled;this.forceCacheUsage=false;this._initialized;this._actionsReady;this._indexedObjects;this.lObjetos;this.llNiveles;this.qImagenes;this.qDescargas;this._preload;this._manifest;this._MCImages;this._hashImages;this.lPictosAudio;this.lCajasColgadas;this.lCajasMudas;this.lConectoresColgados;this.lTrazosColgados;this.stage;this.papel;this.supra_papel;this.logo;this.flechaUp;this.flechaDn;this.tapaFantasma;this.zoomPapel;this.mouseDownEv;this.mouseUpEv;this.mouseMoveEv;this.w;this.h;this.scale;this._needPatch;this.shapeFactory;this.botonera;this.bn_MM;this.bn_MC;this.bn_zoom_mas;this.bn_zoom_men;this.bn_mudo;this.bn_reproducir;this.bn_detalle;this.bn_mapa;this.bn_xml;this.bBnMudo;this.bOcultando;this.bReproduciendo;this.stagedown;this.initJQuery=function(){var d;var c=navigator.userAgent.toLowerCase();jQuery.browser=new Object();jQuery.browser.msie=/msie|trident/.test(c);d=c.match(/(msie|trident)\s*(?:\/\s*)?(.[^;]*)/);if(d){jQuery.browser.engine=$.trim(d[1]);jQuery.browser.version=parseFloat($.trim(d[2]))}else{jQuery.browser.engine="";jQuery.browser.version=-1}};this.initMapaConceptual=function(c){var d=this;d.initJQuery();if(d._initialized==true){return}d._indexedObjects=new Object();d._MCImages=new Object();d._hashImages=new Object();d._mcCanvas=null;d._mcContainer=null;d.zoomPapel=1;d.mouseDownEv=null;d.mouseUpEv=null;d.scale=1;d._needPatch=false;d._isIOS=false;d._isNativeBrowser=false;d._actionsReady=false;if(c==undefined||c==null){d._sourceURL=""}else{d._sourceURL=c}d._initialized=true;d.onDOMContentLoaded(d)};this.initDisplayMapaC=function(){var d=this;var m=d._mcCanvas.getContext("2d");m.strokeStyle="red";m.fillStyle="#FFFFFF";m.fillRect(0,0,d.MC_WIDTH,d.MC_HEIGHT);d.lPictosAudio=new Array();d.stage=new createjs.Stage(d._mcContainerName);var j=new createjs.Shape();d.papel=new createjs.Container();j.graphics.beginFill("#FFFFFF");j.graphics.drawRect(0,0,d.MC_WIDTH,d.MC_HEIGHT);j.graphics.endFill();j.x=0;j.y=0;j.width=d.MC_WIDTH;j.height=d.MC_HEIGHT;d.papel.addChild(j);d.stage.addChild(d.papel);d.stagedown=false;d.logo=new createjs.Bitmap(d._MCImages["logo.png"]);var h=d.logo;h.scaleX=h.scaleY=0.5;h.x=h.y=d.TOP_BORDER;d.shapeFactory=new ExtendedShape();d.flechaUp=d.shapeFactory.embedShape(d.shapeFactory.createTriangle(d.FLECHA_UP_W,d.FLECHA_UP_H,false,false,"#444CA1"),5);d.flechaDn=d.shapeFactory.embedShape(d.shapeFactory.createTriangle(d.FLECHA_DN_W,d.FLECHA_DN_H,false,true,"#444CA1"),5);d.supra_papel=new createjs.Container();d.botonera=new createjs.Container();var e=d.supra_papel;var g=new createjs.Shape();d.botonera.addChild(g);d.stage.addChild(e);e.addChild(d.botonera);g.graphics.beginFill("#FFFFFF");var l=d.BUTTON_W*7+d.BUTTON_SEP*4+d.B_SIDE_BORDER*2+11;g.graphics.drawRect(0,0,l,2*2+d.BUTTON_H-4);g.graphics.endFill();e.x=0;e.y=0;d.botonera.x=d.MC_WIDTH-l-d.B_RIGHT_BORDER;d.botonera.y=d.TOP_BORDER;g.x=0;g.y=0;g.alpha=0;d.botonera.addEventListener("click",function(n){n.stopImmediatePropagation();n.preventDefault()});d.tapaFantasma=new createjs.Shape();d.tapaFantasma.graphics.beginFill("red");d.tapaFantasma.graphics.drawRect(0,2*3+d.BUTTON_H,d.MC_WIDTH,d.MC_HEIGHT-(2*2+d.BUTTON_H));d.tapaFantasma.graphics.endFill();d.tapaFantasma.alpha=0.01;d.tapaFantasma.addEventListener("click",function(n){n.stopImmediatePropagation();n.preventDefault()});var i=0;var c=0;d.bn_reproducir=new createjs.Container();d.bn_reproducir.ocultar=new createjs.Bitmap(d._MCImages["soundon.png"]);d.bn_reproducir.mostrar=new createjs.Bitmap(d._MCImages["soundoff.png"]);d.bn_reproducir.visible=false;d.bn_reproducir.mostrar.visible=true;d.bn_reproducir.ocultar.visible=true;d.bn_reproducir.addChild(d.bn_reproducir.mostrar);d.bn_reproducir.addChild(d.bn_reproducir.ocultar);d.botonera.addChild(d.bn_reproducir);c+=d.BUTTON_SEP;d.bn_reproducir.x=c;d.bn_reproducir.y=1;d.bn_reproducir.mouseChildren=false;d.bn_reproducir.addEventListener("click",function(n){if(n.primary){d.onClic_Reproducir(n,d)}});d.bn_reproducir.cursor="pointer";i++;d.bn_mudo=new createjs.Container();d.bn_mudo.ocultar=new createjs.Bitmap(d._MCImages["ttachado.png"]);d.bn_mudo.mostrar=new createjs.Bitmap(d._MCImages["tnormal.png"]);d.bn_mudo.visible=false;d.bn_mudo.mostrar.visible=false;d.bn_mudo.ocultar.visible=true;d.bn_mudo.addChild(d.bn_mudo.mostrar);d.bn_mudo.addChild(d.bn_mudo.ocultar);d.botonera.addChild(d.bn_mudo);c+=d.BUTTON_SEP+d.BUTTON_W;d.bn_mudo.x=c;d.bn_mudo.y=1;d.bn_mudo.addEventListener("click",function(n){if(n.primary){d.onClic_Mudo(n,d)}});d.bn_mudo.cursor="pointer";i++;d.bn_zoom_mas=new createjs.Container();d.bn_zoom_mas.ocultar=new createjs.Bitmap(d._MCImages["botomes.png"]);d.bn_zoom_mas.mostrar=new createjs.Bitmap(d._MCImages["botomes.png"]);d.bn_zoom_mas.visible=true;d.bn_zoom_mas.mostrar.visible=true;d.bn_zoom_mas.ocultar.visible=true;d.bn_zoom_mas.addChild(d.bn_zoom_mas.mostrar);d.bn_zoom_mas.addChild(d.bn_zoom_mas.ocultar);d.botonera.addChild(d.bn_zoom_mas);c+=d.BUTTON_SEP+d.BUTTON_W;d.bn_zoom_mas.x=c;d.bn_zoom_mas.y=1;d.bn_zoom_mas.addEventListener("click",function(n){if(n.primary){d.onClic_bn_zoom(n,d,"bn_zoom_mas")}});d.bn_zoom_mas.cursor="pointer";i++;d.bn_zoom_men=new createjs.Container();d.bn_zoom_men.ocultar=new createjs.Bitmap(d._MCImages["botomenys.png"]);d.bn_zoom_men.mostrar=new createjs.Bitmap(d._MCImages["botomenys.png"]);d.bn_zoom_men.visible=false;d.bn_zoom_men.mostrar.visible=true;d.bn_zoom_men.ocultar.visible=true;d.bn_zoom_men.addChild(d.bn_zoom_men.mostrar);d.bn_zoom_men.addChild(d.bn_zoom_men.ocultar);d.botonera.addChild(d.bn_zoom_men);c+=d.BUTTON_SEP+d.BUTTON_W;d.bn_zoom_men.x=c;d.bn_zoom_men.y=1;d.bn_zoom_men.addEventListener("click",function(n){if(n.primary){d.onClic_bn_zoom(n,d,"bn_zoom_men")}});d.bn_zoom_men.cursor="pointer";i++;var k=d.formatMCText("ocultar","2222222","left");var f=new createjs.HTMLText(k,"16px "+d.fontGlobal,"#000000");f.topMargin=6;f.leftMargin=3;f.rightMargin=3;f.bottomMargin=2;d.bn_MM=d.shapeFactory.createRoundedCornersRect(f,d.TEXT_BUTTON_W,d.BUTTON_H-7,1,3);d.botonera.addChild(d.bn_MM);d.bn_MM.visible=false;d.bn_MM.mouseChildren=false;d.bn_MM.cursor="pointer";c+=d.BUTTON_SEP+d.BUTTON_W+2;d.bn_MM.x=c;d.bn_MM.y=2;d.bn_MM.addEventListener("click",function(n){if(n.primary){d.onClic_bn_MM(n,d)}});var k=d.formatMCText("mostrar","2222222","left");f=new createjs.HTMLText(k,"16px "+d.fontGlobal,"#000000");f.topMargin=6;f.leftMargin=3;f.rightMargin=3;f.bottomMargin=2;d.bn_MC=d.shapeFactory.createRoundedCornersRect(f,d.TEXT_BUTTON_W,d.BUTTON_H-7,1,3);d.botonera.addChild(d.bn_MC);d.bn_MC.visible=false;d.bn_MC.mouseChildren=false;d.bn_MC.cursor="pointer";d.bn_MC.x=c;d.bn_MC.y=2;d.bn_MC.addEventListener("click",function(n){if(n.primary){d.onClic_bn_MC(n,d)}});i++;d.bBnMudo=0;d.bOcultando=false;d.bReproduciendo=false};this.loadMCImages=function(){var c=this;c._manifest=new Array();c.prepareMCImageManifest();c.startMCImagePreload()};this.prepareMCImageManifest=function(){var e=this;var c=["logo.png","soundon.png","soundoff.png","tnormal.png","ttachado.png","botomes.png","botomenys.png"];for(var d=0;d<c.length;d++){var f=e.getSrc(c[d],"module","motor/images/");e._manifest.push({id:f,src:f,name:c[d]})}};this.startMCImagePreload=function(){var c=this;c._preload=new createjs.LoadQueue();c._preload.on("fileload",function(d){c.onMCImageLoad(c,d)});c._preload.on("complete",function(d){c.onMCImageLoadComplete(c,d)});c._preload.setMaxConnections(3);c._preload.loadManifest(c._manifest)};this.onMCImageLoad=function(e,d){var c=e._preload.getResult(d.item.id);e._MCImages[d.item.name]=c};this.onMCImageLoadComplete=function(d,c){d.initDisplayMapaC();if(window.attachEvent){window.attachEvent("onresize",function(){d.onResizeEvent()})}else{if(window.addEventListener){window.addEventListener("resize",function(){d.onResizeEvent()},true)}}d._manifest=new Array();d.loadXML(datos_xml)};this.onDOMContentLoaded=function(c){var e=c;var d=navigator.userAgent;e._isIOS=(/iPhone|iPad|iPod/i.test(d));e._isNativeBrowser=((d.indexOf("Mozilla/5.0")>-1&&d.indexOf("Android ")>-1&&d.indexOf("AppleWebKit")>-1)&&!(d.indexOf("Chrome")>-1));e._isAndroid=d.indexOf("Android ")>-1;e._isChrome=d.indexOf("Chrome")>-1;e.cacheEnabled=e.forceCacheUsage||(e._isAndroid&&!e._isChrome);TouchComp.init();e._mcCanvas=document.getElementById(e._mcContainerName);e._mcContainer=$(e._mcCanvas).parent().parent().parent()[0];if(e.needContainerSizePatch()){e._needPatch=true}e.loadMCImages()};this.onResizeEvent=function(){var c=this;if(c._isIOS){setTimeout(function(){c.reposition()},500)}else{c.reposition()}};this.reposition=function(){var f=this;var m=$(f._mcContainer).children(".html_mc").children(".mc_container")[0];var h=$(f._mcContainer);var o=h.width();var l=h.height();if(f._needPatch){var k=f.patchContainerSize();l=k.y;if(f._isIOS){o=k.x}}if(f.w!=o||f.h!=l){$(f._diapContainer).css("visibility","hidden");var j=$(m);var g=j.width();var e=j.height();var i;var d;var n=f.getScaledDimensions(o,l,m);i=n.x;d=n.y;var c=i/g;var p=d/e;j.css("-ms-transform-origin","0 0");j.css("-ms-transform-origin-x","0px");j.css("-ms-transform-origin-y","0px");j.css("-webkit-transform-origin-x","0px");j.css("-webkit-transform-origin-y","0px");j.css("-moz-transform-origin-x","0px");j.css("-moz-transform-origin-y","0px");j.css("-o-transform-origin-x","0px");j.css("-o-transform-origin-y","0px");j.css("transform-origin-x","0px");j.css("transform-origin-y","0px");j.css("transform-origin","0 0");j.css("margin-left",(o/2-(g*c)/2)+"px");j.css("top",(l/2-(e*p)/2)+"px");f.stage.scaleX=c;f.stage.scaleY=p;f.stage.canvas.width=i;f.stage.canvas.height=d;f.w=o;f.h=l;$(f._diapContainer).css("visibility","visible")}if(f.cacheEnabled){f.updateCache(f)}if(f._isAndroid&&!f._isChrome){setTimeout(function(){f.stage.update()},1)}else{f.stage.update()}};this.getScaledDimensions=function(i,g,f){var e=f;var c=i;var j=g;var h=e.offsetWidth;var d=e.offsetHeight;var k={x:0,y:0};if(c/j>h/d){k.y=j;k.x=h*(j/d)}else{k.x=c;k.y=d*(c/h)}return k};this.loadXML=function(c){var d=this;XDOM.newXMLFromURL(c,function(e){d.parseXML(e);d.startPreload();d.stage.scaleX=1;d.stage.scaleY=1;d.reposition();if(TouchComp.isTouchDevice()){createjs.Touch.enable(d.stage)}else{d.stage.enableMouseOver(20)}d.stage.mouseChildren=true;d._actionsReady=true},function(f,e){alert("Error al intentar procesar el archivo XML:\n- Status: "+f+".\n -Error: "+e)})};this.parseXML=function(j){var n=this;var w=$(j).children("mapa")[0];var g=$($(w).children("copyright")[0]).text();var e=$($(w).children("version")[0]).text();if(g!="(c) Editorial Planeta"||e!="1.0"){alert("Formato de mapa incorrecto")}else{var d=$.trim($(w).children("botonMapaMudo").text());var u=$(w).children("botonMudo");if(d.length>0){var p=[];for(var s=0;s<d.length;s++){p[s]="2"}p=p.join(",").replace(/,/g,"");var v=n.formatMCText(d,p,"center");var f=new createjs.HTMLText(v,"16px "+n.fontGlobal,"#000000");f.topMargin=6;f.leftMargin=3;f.rightMargin=3;f.bottomMargin=2;var m=f.getBounds();var r=m.width+5*2;var l=$.trim($(w).children("botonMapaConceptual").text());p=[];for(var s=0;s<l.length;s++){p[s]="2"}p=p.join(",").replace(/,/g,"");v=n.formatMCText(l,p,"center");var q=new createjs.HTMLText(v,"16px "+n.fontGlobal,"#000000");q.topMargin=6;q.leftMargin=3;q.rightMargin=3;q.bottomMargin=2;m=q.getBounds();var k=m.width+5*2;var t=Math.max(r,k);var i=n.bn_MM.x;var h=n.bn_MM.y;var o=n.shapeFactory.createRoundedCornersRect(f,t,n.BUTTON_H-7,1,3);o.x=i;o.y=h;n.bn_MM=o;n.bn_MM.cursor="pointer";n.botonera.removeChild(n.bn_MM);n.botonera.addChild(o);n.bn_MM.addEventListener("click",function(c){if(c.primary){n.onClic_bn_MM(c,n)}});var i=n.bn_MM.x;var h=n.bn_MM.y;var z=n.shapeFactory.createRoundedCornersRect(q,t,n.BUTTON_H-7,1,3);z.x=i;z.y=h;n.bn_MC=z;n.bn_MC.cursor="pointer";n.botonera.removeChild(n.bn_MC);n.botonera.addChild(z);n.bn_MC.addEventListener("click",function(c){if(c.primary){n.onClic_bn_MC(c,n)}});if(t>n.TEXT_BUTTON_W){n.botonera.x-=t-n.TEXT_BUTTON_W}}if(u.length>0){if($(u[0]).text()=="0"){n.bBnMudo=0}else{n.bBnMudo=1}}n.fillNodes(w)}};this.fillNodes=function(c){var e=this;e.lObjetos=new Array();e.llNiveles=new Array();for(var d=0;d<16;d++){e.llNiveles[d]=new Array()}e.qImagenes=0;e.qDescargas=0;e.bn_reproducir.visible=false;$(c).children("objeto").each(function(){var l=new Object();var f=$(this).children("ref");var m=$(this).children("audio");l.name=$.trim($(f[0]).text());l.audio=$.trim($(m[0]).text());if(l.audio.length>0){e.bn_reproducir.visible=true}var n=$.trim($($(this).children("texto")[0]).text());var h="";for(var j=0;j<n.length;j++){var s=n[j];var q=n.charCodeAt(j);if(q!=10){h+=s}}l.texto=n;n=$.trim($($(this).children("hijos")[0]).text());if(n.length==0){l.lHijos=new Array()}else{var i=n.split(",");l.lHijos=i}l.padre=$.trim($($(this).children("padre")[0]).text());var o=l.name.charAt(0);l.nivel=parseInt(o,16);l.siz=parseInt($.trim($($(this).children("siz")[0]).text()));l.cen=parseInt($.trim($($(this).children("cen")[0]).text()));var t=$.trim($($(this).children("negcur")[0]).text());l.lNEGCUR=t;e.llNiveles[l.nivel].push(l.name);l.img=$.trim($($(this).children("img")[0]).text());if(l.img.length>0){e.qImagenes++;var p=e.getSrcData(l.img);if(e._hashImages.hasOwnProperty(p)==false){e._hashImages[p]=new Array();e._manifest.push({id:p,src:p,name:l.name})}e._hashImages[p].push(l.name)}else{l.imagen=undefined}if(l.audio!=""){var g=e.getSrc(l.audio,"data","data/sonidos/");var r=XAUDIO.audioCreateTag(g);l.audioIndex=r}e._indexedObjects[l.name]=l;e.lObjetos.push(l)});if(e.qImagenes==0){e.pintarMapa();if(e.cacheEnabled){e.cacheObjects(e)}e.stage.update()}};this.getSrcData=function(e){var d=this;var c=e;if(e.indexOf(".")==0){c=e.substring(1,e.length)}if(c.indexOf("/")!=0){c="/"+c}c=c.replace(".swf",".png");return d._sourceURL+"data/imagenes"+c};this.getSrc=function(g,c,e){var f=this;var d=g;if(g.indexOf(".")==0){d=g.substring(1,g.length)}d=d.replace(".swf",".png");if(c!="data"){return pppPreloader.from(c,"")+e+d}return f._sourceURL+e+d};this.startPreload=function(){var c=this;c._preload=new createjs.LoadQueue();c._preload.on("fileload",function(d){c.handleAssetLoad(c,d)});c._preload.on("complete",function(d){c.imageLoadComplete(c,d)});c._preload.setMaxConnections(3);c._preload.loadManifest(c._manifest)};this.handleAssetLoad=function(f,e){var c=f._preload.getResult(e.item.id);for(var g in f._hashImages[e.item.id]){var h=f._hashImages[e.item.id][g];var d=f._indexedObjects[h];d.imagen=c;f.qDescargas++}};this.imageLoadComplete=function(d,c){d._hashImages=null;d.pintarMapa();if(d.cacheEnabled){d.cacheObjects()}d.stage.update()};this.cacheObjects=function(){for(var f=0;f<this.lCajasColgadas.length;f++){var h=0,g=0;if(this._indexedObjects[this.lCajasColgadas[f].name].audio.length>0){h=-13;g=-9}var e=0,d=0;if(this._indexedObjects[this.lCajasColgadas[f].name].img.length>0){var c=this._indexedObjects[this.lCajasColgadas[f].name].imagen;e=c.width*this.IMAGE_SCALE+8;e=e>this.lCajasColgadas[f].width+10?e:0;d=c.height*this.IMAGE_SCALE+11}if(this._indexedObjects[this.lCajasColgadas[f].name].lHijos.length>0){this.lCajasColgadas[f].cache(0+h,0+g,this.lCajasColgadas[f].width+10+e+Math.abs(h),this.lCajasColgadas[f].height+15+d+Math.abs(g))}else{this.lCajasColgadas[f].cache(0+h,0+g,this.lCajasColgadas[f].width+10+e+Math.abs(h),this.lCajasColgadas[f].height+d+Math.abs(g))}}for(var f=0;f<this.lConectoresColgados.length;f++){this.lConectoresColgados[f].cache(0,0,this.lConectoresColgados[f].width+10,this.lConectoresColgados[f].height)}};this.updateCache=function(d){if(d.lCajasColgadas){for(var c=0;c<d.lCajasColgadas.length;c++){d.lCajasColgadas[c].updateCache()}}if(d.lConectoresColgados){for(var c=0;c<d.lConectoresColgados.length;c++){d.lConectoresColgados[c].updateCache()}}};this.clearCanvas=function(d){d._mcCanvas.getContext("2d").clearRect(0,0,d._mcCanvas.width,d._mcCanvas.height);var c=d._mcCanvas.width;d._mcCanvas.width=1;d._mcCanvas.width=c};this.pintarMapa=function(){var x=this;for(var Y=0;Y<x.papel.numChildren;Y++){var i=x.papel.getChildAt(Y);i.removeEventListener("click",x.onClic_caja)}x.vaciarContainer(x.papel,true);x.supra_papel.addChild(x.logo);var n=new Array();x.lCajasColgadas=new Array();x.lConectoresColgados=new Array();x.lTrazosColgados=Array();if(x.bBnMudo==0){x.bn_mudo.visible=false}else{x.bn_mudo.visible=true}var U=x.crearCAJ("00");U.name="00";x._indexedObjects["00"].caja=U;var Q=x.MC_WIDTH/2;x.colgarCAJ(U,[Q-U.width/2,10]);n[0]=["00"];var P=x.getQNiveles();var q;for(var R=2;R<P;R+=2){var L=new Array();for(var r in n[R-2]){L.push(n[R-2][r])}var ah=x.getHeightMaxCaj(L);n[R]=new Array();for(var ad in n[R-2]){var B;var l=x._indexedObjects[n[R-2][ad]];var W=x.getHeightMaxCaj([l.name]);var ag=l.lHijos.length;var d=l.caja.x+l.caja.width/2;var D=l.caja.y+l.caja.h2+((l.name=="00")?0:20);var X=d;var af;var ac=new createjs.Shape();var A={x:-1,y:-1,rightX:-1,bottomY:-1};x.lTrazosColgados.push(ac);l.trazos=ac;l.trazos.nodosEnlazados=new Array();l.trazos.nodosEnlazados.push(l.name);x.papel.addChild(ac);ac.graphics.setStrokeStyle(2);ac.graphics.beginStroke("#727CDD");ac.graphics.moveTo(d,D);if(ag==1){var M=l.lHijos[0];x._indexedObjects["c"+M]=x.crearCON(M);var F=x.getHeightMax([M]);var J=0;if(x._indexedObjects[M].texto!=""){if(R<=2){x.colgarCON(x._indexedObjects["c"+M],[d,D+10])}else{x.colgarCON(x._indexedObjects["c"+M],[d,D+10],true)}af=D+J+10+x._indexedObjects["c"+M].height+10}else{af=D+J+ +10}A.y=af;ac.graphics.lineTo(X,af);A=x.actualizarTrazosBounds(A,X,af);B=x._indexedObjects[M];var E=B.lHijos;var O=E.length;var ab=x.getWidthTotal(E);var K=x.getHeightMaxCaj(E);var aj;if(R==2){aj=(x.MC_WIDTH-ab)/O;q=aj/2}else{var t=x.luzInterGlobal*(O-1)+ab;q=X-t/2}var o=false;if(q<x.luzInterGlobal){q=x.luzInterGlobal;if(E.length==1){o=true}}if(x.MC_WIDTH-(q+t)<x.luzInterGlobal){q=x.MC_WIDTH-t-x.luzInterGlobal;if(E.length==1){o=true}}for(var C in E){var ai=0;var w=x.getHeightMaxCaj([E[C]]);if(K>w){ai=K-w}U=x.crearCAJ(E[C]);U.name=E[C];x._indexedObjects[E[C]].caja=U;n[R].push(E[C]);if(R<=2){x.colgarCAJ(U,[q,af+ai+10])}else{x.colgarCAJ(U,[q,af+ai+10],true)}l.trazos.nodosEnlazados.push(U.name);if(R>2){q=U.x+U.width+x.luzInterGlobal}else{q=U.x+U.width+aj}if(o){ac.graphics.moveTo(X,U.y);A=x.actualizarTrazosBounds(A,X,U.y);ac.graphics.lineTo(X,af);A=x.actualizarTrazosBounds(A,X,af)}else{ac.graphics.moveTo(U.x+U.width/2,U.y);A=x.actualizarTrazosBounds(A,U.x+U.width/2,U.y);ac.graphics.lineTo(U.x+U.width/2,af);A=x.actualizarTrazosBounds(A,U.x+U.width/2,af)}ac.graphics.lineTo(X,af);A=x.actualizarTrazosBounds(A,X,af);x.colgarFlecha(U)}}else{if(ag>1){var m;var J=(R==4)?ah-W-10:0;af=D+J+10;A.y=af-J;ac.graphics.lineTo(X,af);A=x.actualizarTrazosBounds(A,X,af);var f=l.lHijos.slice(0);var h=x.getHeightMax(f);var T;if(h>0){T=af+h+30}else{T=af+20}var I=l.lHijos.length;var Z=0;var aa=0,V=0;var p;var S=0;for(var c in f){var u=new Array();u.push(f[c].toString());aa=x.getWidthTotalCon(u);V=x.getWidthTotal(x._indexedObjects[f[c]].lHijos);p=Math.max(aa,V);Z+=p;S+=x._indexedObjects[f[c]].lHijos.length-1;S++}Z+=x.luzInterGlobal*S;if(R==2){var z=(x.MC_WIDTH-Z)/I;q=z/2-x.luzInterGlobal-z;for(var c in l.lHijos){B=x._indexedObjects[l.lHijos[c]];m=q+x.luzInterGlobal+z+(x.getWidthTotal(B.lHijos)+2*(B.lHijos.length-1))/2;q+=z;for(var C in B.lHijos){var G=B.lHijos[C];q+=x.luzInterGlobal;U=x.crearCAJ(G);U.name=G;x._indexedObjects[G].caja=U;n[R].push(G);if(R<=2){x.colgarCAJ(U,[q,T])}else{x.colgarCAJ(U,[q,T],true)}l.trazos.nodosEnlazados.push(U.name);q=U.x+U.width;ac.graphics.moveTo(U.x+U.width/2,U.y);A=x.actualizarTrazosBounds(A,U.x+U.width/2,U.y);ac.graphics.lineTo(U.x+U.width/2,U.y-10);A=x.actualizarTrazosBounds(A,U.x+U.width/2,U.y-10);ac.graphics.lineTo(m,U.y-10);A=x.actualizarTrazosBounds(A,m,U.y-10);ac.graphics.lineTo(m,af);A=x.actualizarTrazosBounds(A,m,af);ac.graphics.lineTo(X,af);A=x.actualizarTrazosBounds(A,X,af);x.colgarFlecha(U)}x._indexedObjects["c"+l.lHijos[c]]=x.crearCON(l.lHijos[c]);if(x._indexedObjects[l.lHijos[c]].texto!=""){if(R<=2){x.colgarCON(x._indexedObjects["c"+l.lHijos[c]],[m,af+10])}else{x.colgarCON(x._indexedObjects["c"+l.lHijos[c]],[m,af+10],true)}}}}else{q=d-Z/2;q=Math.max(2,q);var ak=q+Z-x.MC_WIDTH;if(ak>0){q-=ak}var p=0;for(var c in l.lHijos){B=x._indexedObjects[l.lHijos[c]];var u=new Array();u.push(l.lHijos[c].toString());aa=x.getWidthTotalCon(u);V=x.getWidthTotal(B.lHijos);p=Math.max(aa,V);p+=x.luzInterGlobal*(B.lHijos.length-1)+x.luzInterGlobal;if(aa>V){m=q+(aa+x.luzInterGlobal*(B.lHijos.length-1))/2}else{m=q+(V+x.luzInterGlobal*(B.lHijos.length-1))/2}var ae=0;var N=0;var y=x.getWidthTotal(B.lHijos)+x.luzInterGlobal*(B.lHijos.length-1);var H=x.getWidthTotalCon([l.lHijos[c].toString()]);q=m-y/2;for(var C in B.lHijos){var G=B.lHijos[C];var s=x.getWidthTotal([G]);U=x.crearCAJ(G);U.name=G;x._indexedObjects[G].caja=U;n[R].push(G);if(R<=2){x.colgarCAJ(U,[q,T])}else{x.colgarCAJ(U,[q,T],true)}l.trazos.nodosEnlazados.push(U.name);ae+=s+x.luzInterGlobal;q=q+U.width+x.luzInterGlobal;ac.graphics.moveTo(U.x+U.width/2,U.y);A=x.actualizarTrazosBounds(A,U.x+U.width/2,U.y);ac.graphics.lineTo(U.x+U.width/2,U.y-10);A=x.actualizarTrazosBounds(A,U.x+U.width/2,U.y-10);ac.graphics.lineTo(m,U.y-10);A=x.actualizarTrazosBounds(A,m,U.y-10);ac.graphics.lineTo(m,af);A=x.actualizarTrazosBounds(A,m,af);ac.graphics.lineTo(X,af);A=x.actualizarTrazosBounds(A,X,af);x.colgarFlecha(U);N++}if(H>y){q+=(m+H/2)-q+x.luzInterGlobal}x._indexedObjects["c"+l.lHijos[c]]=x.crearCON(l.lHijos[c]);if(x._indexedObjects[l.lHijos[c]].texto!=""){if(R<=2){x.colgarCON(x._indexedObjects["c"+l.lHijos[c]],[m,af+10])}else{x.colgarCON(x._indexedObjects["c"+l.lHijos[c]],[m,af+10],true)}}}}}}l.trazos.setBounds(A.x,A.y,A.rightX-A.x,A.bottomY-A.y)}}for(var e in x._indexedObjects["00"].lHijos){var j=x._indexedObjects["00"].lHijos[e];for(var g in x._indexedObjects[j].lHijos){var v=x._indexedObjects[j].lHijos[g];x.ocultarArbol(v)}}x.papel.visible=true;x.bn_MM.visible=false;x.bn_MC.visible=false;x.stage.on("stagemousedown",function(k){x.onDN_papel(k,x)});x.stage.on("stagemouseup",function(k){x.onUP_papel(k,x)});x.bReproduciendo=false};this.vaciarContainer=function(e,c){if(c==undefined){c=false}while(e.numChildren>0){var d=e.removeChildAt(0);if(c){d=null}}};this.crearCAJ=function(d){var y=this;var s=y._indexedObjects[d];if(s.caja!=undefined&&s.caja!=null){return s.caja}else{}var k=0;var h=0;var l;var e=s.nivel;var A=(e>6)?"#444CA1":"#FFFFFF";var v=s.siz;if(s.texto.length>0){if(s.siz==0){if(e>6){v=14}else{v=[20,0,18,0,16,0,14][e]}}else{v=s.siz;s.siz=v}var z=(s.cen==1)?"center":"left";var C=y.formatMCText(s.texto,s.lNEGCUR,z);var l=new createjs.HTMLText(C,v+"px "+y.fontGlobal,A);l.topMargin=6;l.leftMargin=3;l.rightMargin=3;l.bottomMargin=2;l.lineHeight=y.lInterlineados[v];var i=l.getBounds();k=i.width;h=i.height;l.width=i.width;l.height=i.height}var p=0;var o=0;var D,u;if(s.imagen!=undefined){D=s.imagen;p=D.width*y.IMAGE_SCALE;o=D.height*y.IMAGE_SCALE;u=new createjs.Bitmap(D);u.scaleX=y.IMAGE_SCALE;u.scaleY=y.IMAGE_SCALE}var r=Math.max(k,p);var B=h+o;var n=new createjs.Container();var q=new createjs.Container();var m=new createjs.Shape();var c;switch(e){case 0:c="#0625B4";break;case 2:c="#002AAD";break;case 4:c="#1940FF";break;case 6:c="#6781F2";break;case 8:c="#0A2590";break;case 10:c="#727CDD";break}if(k>0){switch(e){case 0:m.graphics.beginFill("#0625B4");break;case 2:m.graphics.beginFill("#002AAD");break;case 4:m.graphics.beginFill("#1940FF");break;case 6:m.graphics.beginFill("#6781f2");break;case 8:m.graphics.beginFill("#FFFFFF");m.graphics.setStrokeStyle(1);m.graphics.beginStroke("#0A2590");break;case 10:m.graphics.beginFill("#FFFFFF");m.graphics.setStrokeStyle(1);m.graphics.beginStroke("#727CDD");break}m.graphics.drawRect(0,0,r+8,h);m.graphics.endFill();if(l!=undefined){l.x=(r+8-k)/2;l.y=0;n.texto=l;q.addChild(m);q.addChild(l);n.addChild(q)}}var t=r;n.width=t+10;n.height=h;var g=0;if(p>0){u.x=(t+8-p)/2;var j=n.height;u.y=j+5;n.img=u;var x=new createjs.Shape();x.graphics.beginFill("#FFFFFF",0);x.graphics.drawRect(0,j,t+8,o+11);x.graphics.endFill();n.addChild(x);n.addChild(u);x.graphics.setStrokeStyle(1);x.graphics.beginStroke(c);x.graphics.drawRect(0,j,t+8,o+11);g=11}n.h2=B+g;if(s.audio!=""){var w=y.shapeFactory.createTriangle(y.FLECHA_AUDIO_W,y.FLECHA_AUDIO_H,true,false,"#444CA1");var f=y.shapeFactory.embedShape(y.shapeFactory.addRoundedBorder(w,2,1,"#444CA1"),15);y.lPictosAudio.push(f);n.addChild(f);f.x=n.x-9;f.y=n.y-5;f.mouseChildren=false;f.addEventListener("click",function(E){E.stopPropagation();if(E.primary){y.onClickPlaySound(E,y,s.audioIndex)}});if(y.bReproduciendo==false){f.visible=false}else{f.visible=true}}return n};this.crearCON=function(l){var c=this;var g=c._indexedObjects[l];var m=g.siz;if(g.texto.length>0){if(g.siz==0){m=14;g.siz=m}else{m=g.siz;g.siz=m}}var f=(g.cen==1)?"center":"left";var j=c.formatMCText(c._indexedObjects[l].texto,g.lNEGCUR,f);var e=new createjs.HTMLText(j,m+"px "+c.fontGlobal,"#444CA1");e.topMargin=6;e.leftMargin=3;e.rightMargin=3;e.bottomMargin=0;e.lineHeight=c.lInterlineados[m];var d;var i;if(e.text.length==0){d=0;i=0}else{var n=e.getBounds();d=n.width;i=n.height+4}var k=new createjs.Container();var h=new createjs.Shape();h.graphics.beginFill("#FFFFFF");h.graphics.setStrokeStyle(1);h.graphics.beginStroke("#FFFFFF");h.graphics.drawRect(0,0,d,i);h.graphics.endFill();k.addChild(h);k.addChild(e);k.name=l;k.width=d+10;k.height=i;return k};this.colgarCAJ=function(d,h,c){var f=this;d.x=h[0];d.y=h[1];d.on("click",function(i){f.onClic_caja(i,f,d.name)});if(d.name!="00"){d.cursor="pointer"}if(c==undefined||c===true){if(!f.papel.getChildByName(d.name)){f.papel.addChild(d)}var g=false;for(var e=0;e<f.lCajasColgadas.length;e++){if(f.lCajasColgadas[e].name==d.name){g=true;break}}if(!g){f.lCajasColgadas.push(d)}}};this.getQNiveles=function(){var e=this;var c=0;for(var d=0;d<16;d++){if(e.llNiveles[d].length>0){c++}}return c};this.colgarCON=function(d,k,c){var g=this;var j=Math.max(10,k[0]-d.width/2);var f=j+d.width-g.MC_WIDTH+10;if(f>0){j-=f}d.x=j;d.y=k[1];if(c==undefined||c===true){if(!g.papel.getChildByName(d.name)){g.papel.addChild(d)}var h=false;for(var e=0;e<g.lConectoresColgados.length;e++){if(g.lConectoresColgados[e].name==d.name){h=true;break}}if(!h){g.lConectoresColgados.push(d)}}};this.mostrarArbol=function(i){var h=this;var g=h._indexedObjects[i];h._indexedObjects["flechaUp_"+i].visible=true;h._indexedObjects["flechaDn_"+i].visible=false;g.trazos.visible=true;for(var f in g.lHijos){var d=g.lHijos[f];if(!h.papel.getChildByName(d)){h.papel.addChild(h._indexedObjects["c"+d])}h._indexedObjects["c"+d].visible=true;h.chequeaColision(h._indexedObjects["c"+d],g.trazos,g.lHijos);for(var c in h._indexedObjects[d].lHijos){var e=h._indexedObjects[d].lHijos[c];if(!h.papel.getChildByName(e)){h.papel.addChild(h._indexedObjects[e].caja)}h._indexedObjects[e].caja.visible=true;h.chequeaColision(h._indexedObjects[e].caja,g.trazos,h._indexedObjects[d].lHijos)}}h.bn_MM.visible=true;h.bn_MC.visible=false;h.stage.update()};this.ocultarArbol=function(h){if(h.length==0){return}var g=this;var f=g._indexedObjects[h];if(f.lHijos.length==0){return}else{if(g._indexedObjects["flechaUp_"+h]!=undefined){g._indexedObjects["flechaUp_"+h].visible=false}if(g._indexedObjects["flechaDn_"+h]!=undefined){g._indexedObjects["flechaDn_"+h].visible=true}f.trazos.visible=false;for(var e in f.lHijos){g._indexedObjects["c"+f.lHijos[e]].visible=false;for(var c in g._indexedObjects[f.lHijos[e]].lHijos){var d=g._indexedObjects[f.lHijos[e]].lHijos[c];g._indexedObjects[d].caja.visible=false;g.ocultarArbol(d)}}}g.stage.update()};this.colgarFlecha=function(c){var e=this;if(e._indexedObjects[c.name].lHijos.length>0){var g=c.h2;if(e._indexedObjects["flechaUp_"+c.name]==undefined){var d=e.flechaUp.clone(true);d.x=c.width/2-(e.flechaUp.width/2);d.y=g+2;d.cursor="pointer";d.mouseChildren=false;c.addChild(d);e._indexedObjects["flechaUp_"+c.name]=d}if(e._indexedObjects["flechaDn_"+c.name]==undefined){var f=e.flechaDn.clone(true);f.x=c.width/2-(e.flechaDn.width/2);f.y=g+1;f.cursor="pointer";f.mouseChildren=false;c.addChild(f);e._indexedObjects["flechaDn_"+c.name]=f}}};this.formatMCText=function(m,l,j){var k=new Array();var d;var g=0;if(!l){l=""}if(l.length<m.length){for(var h=0;h<m.length-l.length;h++){l+="0"}}d=new createjs.HTMLTextPara();d.align=j;var n="";var c=l.charAt(0);var o=true;while(g<m.length){if(m.charAt(g)=="\r"||m.charAt(g)=="\n"){if(n!=""){var f=new createjs.HTMLTextRun(n,"");d.items.push(f);n=""}k.push(d);d=new createjs.HTMLTextPara();d.align=j}else{if(c!=l.charAt(g)||(o&&c!=0)){var e="";if(c=="1"){e="italic"}else{if(c=="2"){e="bold"}}var f=new createjs.HTMLTextRun(n,e);d.items.push(f);n=m.charAt(g);c=l.charAt(g);o=false}else{n+=m.charAt(g)}}g++}if(n!=""){var f=new createjs.HTMLTextRun(n,c);d.items.push(f);n=""}if(d.items.length>0){k.push(d)}return k};this.getWidthTotal=function(e){var f=this;var c=0;for(var g in e){var d=f.crearCAJ(e[g]);if(f._indexedObjects[e[g]].caja==undefined){f._indexedObjects[e[g]].caja=d}if(d.width!=null&&d.width!=undefined&&!isNaN(d.width)){c+=d.width}d=null}return c};this.getWidthTotalCon=function(d){var e=this;var c=0;for(var f in d){var g=e.crearCON(d[f]);if(e._indexedObjects[d[f]].caja==undefined){e._indexedObjects[d[f]].caja=g}if(g.width!=null&&g.width!=undefined&&!isNaN(g.width)){c+=g.width}g=null}return c};this.getHeightMax=function(e){var f=this;var c=0;for(var g in e){if(f._indexedObjects[e[g]].texto!=""){var d=f.crearCON(e[g]);if(d.height>c){c=d.height}d=null}}return c};this.getHeightMaxCaj=function(e){var f=this;var c=0;for(var g in e){if(f._indexedObjects[e[g]]&&f._indexedObjects[e[g]].texto!=""){var d=f.crearCAJ(e[g]);if(d.height>c){c=d.height}d=null}}return c};this.chequeaColision=function(j,h,k){var e=this;for(var g in e.lCajasColgadas){var m=e.lCajasColgadas[g];if(m.visible&&e.hitTestObject(j,m)){if(m.name!=j.name){e.ocultarArbol(e.getAbuelo(m.name))}}}for(var l in e.lConectoresColgados){var i=e.lConectoresColgados[l];if(i.visible&&e.hitTestObject(j,i)){if(i.name!=j.name){e.ocultarArbol(e._indexedObjects[i.name].padre)}}}var d=h.getBounds();for(var n in e.lTrazosColgados){var f=e.lTrazosColgados[n];if(f.visible){var c=f.getBounds();if(f.id!=h.id&&e.checkIntersection(c,d)){}for(var g in k){var m=e._indexedObjects[k[g]];if(m.hasOwnProperty("caja")){m=m.caja;if(m.visible&&f.id!=h.id&&e.hitTestObjectTrazo(m,c)){e.ocultarArbol(e.getAbuelo(f.nodosEnlazados[f.nodosEnlazados.length-1]))}}}}}for(var g in e.lCajasColgadas){var m=e.lCajasColgadas[g];if(m.visible&&e.hitTestObjectTrazo(m,d)){if(k.indexOf(m.name)==-1){e.ocultarArbol(e.getAbuelo(m.name))}}}return true};this.getAbuelo=function(d){var c=this;if(c._indexedObjects[c._indexedObjects[d].padre]==undefined){return""}return c._indexedObjects[c._indexedObjects[d].padre].padre};this.hitTestObject=function(i,g){var c=this;var m=(i.h2!=undefined)?i.h2:i.height;var l=(g.h2!=undefined)?g.h2:g.height;var h=i.localToGlobal?i.localToGlobal(0,0).x:i.x;var e=i.localToGlobal?i.localToGlobal(i.width,0).x:i.x+i.width;var k=i.localToGlobal?i.localToGlobal(0,0).y:i.y;var o=i.localToGlobal?i.localToGlobal(0,m).y:i.y+m;var f=g.localToGlobal?g.localToGlobal(0,0).x:g.x;var d=g.localToGlobal?g.localToGlobal(g.width,0).x:g.x+g.width;var j=g.localToGlobal?g.localToGlobal(0,0).y:g.y;var n=g.localToGlobal?g.localToGlobal(0,l).y:g.y+l;return c.intersectRect(i,{left:h,right:e,top:k,bottom:o},g,{left:f,right:d,top:j,bottom:n})};this.hitTestObjectTrazo=function(f,e){var d=this;var c=(f.h2!=undefined)?f.h2:f.height;return d.checkIntersection({x:f.x,width:f.width,y:f.y,height:c},e)};this.intersectRect=function(f,d,e,c){return !(c.left>d.right+5||c.right<d.left-5||c.top>d.bottom+5||c.bottom<d.top-5)};this.actualizarTrazosBounds=function(c,e,d){if(c.x>e||c.x==-1){c.x=e}if(c.rightX<e){c.rightX=e}if(c.y>d){c.y=d}if(c.bottomY<d){c.bottomY=d}return c};this.checkIntersection=function(d,c){if(d.x>=c.x+c.width||d.x+d.width<=c.x||d.y>=c.y+c.height||d.y+d.height<=c.y){return false}return true};this.styleToObject=function(f){var g=f.split(";");var e;var d=new Object();for(e=0;e<g.length;e++){var c=g[e].trim();if(c==""){continue}var h=g[e].split(":");d[h[0].toLowerCase().trim()]=h[1].toLowerCase().trim()}return d};this.needContainerSizePatch=function(){var e=this;if($(e._mcContainer).parent().is("body")==false){return false}var d=$(e._mcContainer).attr("style");if(d){var c=this.styleToObject(d);if(c.height=="100%"){return true}}return false};this.patchContainerSize=function(){var c=window.innerWidth?window.innerWidth:$(window).width();var f=window.innerHeight?window.innerHeight:$(window).height();var e="none";if(this._isIOS){var d=window;while(d.parent!=null&&d.parent!=d){d=d.parent}if(d.orientation==0||d.orientation==180){if(c>768){c=768}e="v:"+d.orientation}else{e="h: "+d.orientation}}return{x:c,y:f}};this.onClic_caja=function(h,g,k){if(!h.primary){return}var f=g._indexedObjects[k];if(g.bReproduciendo==true){if(f.audio!=""){g.onClickPlaySound(h,g,f.audioIndex)}return}if(g.bOcultando==true){if(k!="00"){var c=null;for(var j in g.lCajasColgadas){var d=g.lCajasColgadas[j];if(d.name==k){c=d}}var i=false;if(c.texto!=null&&c.texto!=undefined){c.texto.visible=!c.texto.visible;i=true}if(c.img!=undefined){c.img.visible=!c.img.visible;i=true}if(i==true&&c!=null){g.stage.update()}}}else{if(k!="00"&&g._indexedObjects[k].lHijos.length>0){if(g._indexedObjects["flechaUp_"+k]==undefined){return}if(g._indexedObjects["flechaUp_"+k].visible==true){g.onClic_flechaUp(h,g,k);if(g.cacheEnabled){g.updateCache(g);g.stage.update()}}else{if(g._indexedObjects["flechaDn_"+k].visible==true){g.onClic_flechaDn(h,g,k);if(g.cacheEnabled){g.updateCache(g);g.stage.update()}}}}}};this.onClic_flechaDn=function(f,d,c){f.stopImmediatePropagation();f.preventDefault();d._indexedObjects["flechaUp_"+c].visible=true;d.mostrarArbol(c);if(d.cacheEnabled){d._indexedObjects[c].caja.updateCache()}};this.onClic_flechaUp=function(f,d,c){f.stopImmediatePropagation();f.preventDefault();d._indexedObjects["flechaDn_"+c].visible=true;d.ocultarArbol(c);if(d.cacheEnabled){d._indexedObjects[c].caja.updateCache()}};this.onClic_Mudo=function(g,f){f.bReproduciendo=false;f.bn_reproducir.mostrar.visible=false;f.bn_reproducir.ocultar.visible=true;for(var d=0;d<f.lPictosAudio.length;d++){f.lPictosAudio[d].visible=false}f.bOcultando=!f.bOcultando;if(f.bOcultando){f.bn_mudo.mostrar.visible=true;f.bn_mudo.ocultar.visible=false}else{f.bn_mudo.mostrar.visible=false;f.bn_mudo.ocultar.visible=true;f.bn_MM.visible=true;f.bn_MC.visible=false;for(var h in f.lCajasColgadas){var c=f.lCajasColgadas[h];if(c.texto!=null){c.texto.visible=true}if(c.img){c.img.visible=true}}}if(f.cacheEnabled){f.updateCache(f)}f.stage.update()};this.onClic_bn_MM=function(f,d){d.bn_MM.visible=false;d.bn_MC.visible=true;d.lCajasMudas=new Array();for(var g in d.lCajasColgadas){var c=d.lCajasColgadas[g];if(d._indexedObjects[c.name].nivel>2&&c.visible){if(c.texto!=null){c.texto.visible=false}if(c.img){c.img.visible=false}d.lCajasMudas.push(c)}}d.papel.addChild(d.tapaFantasma);d.tapaFantasma.visible=true;if(d.cacheEnabled){d.updateCache(d)}d.stage.update()};this.onClic_bn_MC=function(f,d){d.bn_MM.visible=true;d.bn_MC.visible=false;for(var g in d.lCajasMudas){var c=d.lCajasMudas[g];if(c.texto!=null){c.texto.visible=true}if(c.img){c.img.visible=true}}d.papel.removeChild(d.tapaFantasma);if(d.cacheEnabled){d.updateCache(d)}d.stage.update()};this.onClic_Reproducir=function(f,d){d.bOcultando=false;d.bn_mudo.mostrar.visible=false;d.bn_mudo.ocultar.visible=true;d.bReproduciendo=!d.bReproduciendo;if(d.bReproduciendo){d.bn_reproducir.mostrar.visible=true;d.bn_reproducir.ocultar.visible=false;for(var c=0;c<d.lPictosAudio.length;c++){d.lPictosAudio[c].visible=true}}else{d.bn_reproducir.mostrar.visible=false;d.bn_reproducir.ocultar.visible=true;d.tapaFantasma.visible=false;for(var c=0;c<d.lPictosAudio.length;c++){d.lPictosAudio[c].visible=false}}if(d.cacheEnabled){d.updateCache(d)}d.stage.update()};this.onClickPlaySound=function(g,f,c){var h=XAUDIO.audioGetId(c);var d=document.getElementById(h);if(!d){return}if(d.duration>0&&!d.paused){d.pause()}else{if(d.duration>0&&d.paused){XAUDIO.audioPlay(c)}else{XAUDIO.audioStart(c)}}};this.onClic_bn_zoom=function(f,d,c){if(c=="bn_zoom_mas"){if(d.zoomPapel<2){d.zoomPapel+=0.25;d.papel.scaleX=d.papel.scaleY=d.zoomPapel}}else{if(d.zoomPapel>1){d.zoomPapel-=0.25;d.papel.scaleX=d.papel.scaleY=d.zoomPapel}}switch(d.zoomPapel){case 1:d.bn_zoom_men.visible=false;d.papel.x=d.papel.y=0;break;case 2:d.bn_zoom_mas.visible=false;break;default:d.bn_zoom_mas.visible=true;d.bn_zoom_men.visible=true;break}d.stage.update()};this.onDN_papel=function(d,c){d.stopImmediatePropagation();d.preventDefault();if(!d.primary){return}c.difX=(d.stageX/c.stage.scaleX)-c.papel.x;c.difY=(d.stageY/c.stage.scaleY)-c.papel.y;c.stagedown=true;c.stage.on("stagemousemove",function(e){c.onMOVE_papel(e,c)})};this.onUP_papel=function(d,c){if(!d.primary){return}if(c.stagedown){c.stage.removeAllEventListeners("stagemousemove");c.stagedown=false;if(c.cajadown&&c.hitTestObject(c.cajadown,{x:d.stageX,y:d.stageY,width:1,height:1})){c.onClic_caja(d,c,c.cajadown.name);c.cajadown=null}}};this.onMOVE_papel=function(d,c){if(!d.primary){return}c.papel.x=d.stageX/c.stage.scaleX-c.difX;c.papel.y=d.stageY/c.stage.scaleY-c.difY;c.stage.update()}};